# go-broadcast configuration for microservices architecture
# Syncs common tooling and CI/CD configuration across multiple services

version: 1

source:
  repo: "company/microservices-template"
  branch: "master"

defaults:
  branch_prefix: "sync/tooling"
  pr_labels:
    - "automated-sync"
    - "tooling-update"
    - "ci-cd"

targets:
  # User service
  - repo: "company/user-service"
    files:
      # CI/CD pipeline
      - src: ".github/workflows/ci.yml"
        dest: ".github/workflows/ci.yml"
      - src: ".github/workflows/deploy.yml"
        dest: ".github/workflows/deploy.yml"
      # Development tools
      - src: "Makefile"
        dest: "Makefile"
      - src: ".golangci.yml"
        dest: ".golangci.yml"
      - src: "docker-compose.dev.yml"
        dest: "docker-compose.dev.yml"
      # Documentation templates
      - src: "docs/API.md"
        dest: "docs/API.md"
    transform:
      repo_name: true
      variables:
        SERVICE_NAME: "user-service"
        SERVICE_PORT: "8001"
        DATABASE_NAME: "users"

  # Order service
  - repo: "company/order-service"
    files:
      - src: ".github/workflows/ci.yml"
        dest: ".github/workflows/ci.yml"
      - src: ".github/workflows/deploy.yml"
        dest: ".github/workflows/deploy.yml"
      - src: "Makefile"
        dest: "Makefile"
      - src: ".golangci.yml"
        dest: ".golangci.yml"
      - src: "docker-compose.dev.yml"
        dest: "docker-compose.dev.yml"
      - src: "docs/API.md"
        dest: "docs/API.md"
    transform:
      repo_name: true
      variables:
        SERVICE_NAME: "order-service"
        SERVICE_PORT: "8002"
        DATABASE_NAME: "orders"

  # Payment service
  - repo: "company/payment-service"
    files:
      - src: ".github/workflows/ci.yml"
        dest: ".github/workflows/ci.yml"
      - src: ".github/workflows/deploy.yml"
        dest: ".github/workflows/deploy.yml"
      - src: "Makefile"
        dest: "Makefile"
      - src: ".golangci.yml"
        dest: ".golangci.yml"
      - src: "docker-compose.dev.yml"
        dest: "docker-compose.dev.yml"
      - src: "docs/API.md"
        dest: "docs/API.md"
      # Additional security configurations for payment service
      - src: "security/policies.yml"
        dest: "security/policies.yml"
    transform:
      repo_name: true
      variables:
        SERVICE_NAME: "payment-service"
        SERVICE_PORT: "8003"
        DATABASE_NAME: "payments"
        SECURITY_LEVEL: "high"

  # Gateway service (different file structure)
  - repo: "company/api-gateway"
    files:
      - src: ".github/workflows/ci.yml"
        dest: ".github/workflows/ci.yml"
      - src: ".github/workflows/deploy.yml"
        dest: ".github/workflows/deploy.yml"
      - src: "Makefile"
        dest: "Makefile"
      - src: ".golangci.yml"
        dest: ".golangci.yml"
      # Gateway-specific configuration
      - src: "configs/gateway.template.yml"
        dest: "configs/gateway.yml"
      - src: "docs/Gateway.md"
        dest: "README.md"
    transform:
      repo_name: true
      variables:
        SERVICE_NAME: "api-gateway"
        SERVICE_PORT: "8000"
        UPSTREAM_SERVICES: "user-service,order-service,payment-service"
